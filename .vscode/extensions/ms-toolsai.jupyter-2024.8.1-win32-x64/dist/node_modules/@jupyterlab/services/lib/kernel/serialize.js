"use strict";Object.defineProperty(exports,"__esModule",{value:!0});exports.serialize=exports.deserialize=void 0;function a(t){let e;return typeof t=="string"?e=JSON.parse(t):e=d(t),e}exports.deserialize=a;function h(t){var e;let n;return!((e=t.buffers)===null||e===void 0)&&e.length?n=g(t):n=JSON.stringify(t),n}exports.serialize=h;function d(t){let e=new DataView(t),n=e.getUint32(0),i=[];if(n<2)throw new Error("Invalid incoming Kernel Message");for(let s=1;s<=n;s++)i.push(e.getUint32(s*4));let f=new Uint8Array(t.slice(i[0],i[1])),o=JSON.parse(new TextDecoder("utf8").decode(f));o.buffers=[];for(let s=1;s<n;s++){let l=i[s],u=i[s+1]||t.byteLength;o.buffers.push(new DataView(t.slice(l,u)))}return o}function g(t){let e=[],n=[],i=new TextEncoder,f=[];t.buffers!==void 0&&(f=t.buffers,delete t.buffers);let o=i.encode(JSON.stringify(t));n.push(o.buffer);for(let r=0;r<f.length;r++){let c=f[r];n.push(ArrayBuffer.isView(c)?c.buffer:c)}let s=n.length;e.push(4*(s+1));for(let r=0;r+1<n.length;r++)e.push(e[e.length-1]+n[r].byteLength);let l=new Uint8Array(e[e.length-1]+n[n.length-1].byteLength),u=new DataView(l.buffer);u.setUint32(0,s);for(let r=0;r<e.length;r++)u.setUint32(4*(r+1),e[r]);for(let r=0;r<n.length;r++)l.set(new Uint8Array(n[r]),e[r]);return l.buffer}

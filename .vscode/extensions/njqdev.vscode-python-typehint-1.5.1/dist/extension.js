(()=>{"use strict";var t={113:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.ReturnHintCompletionProvider=e.ParamHintCompletionProvider=e.CompletionProvider=void 0;const r=i(496),o=i(872),s=i(949),a=i(386),c=i(705);class l{constructor(){this.itemSortPrefix=90,this.newCompletionitem=(t,e)=>{const i=new r.CompletionItem(this.labelFor(t),r.CompletionItemKind.TypeParameter);return i.sortText=e+t,i}}pushHintsToItems(t,e,i){const n=this.itemSortPrefix.toString();e.push(i?this.selectedCompletionItem(t[0]):this.newCompletionitem(t[0],n));for(let i=1;i<t.length;i++)e.push(this.newCompletionitem(t[i],n))}selectedCompletionItem(t,e="0b"){let i=new r.CompletionItem(this.labelFor(t),r.CompletionItemKind.TypeParameter);return i.sortText=`${e}${t}`,i.preselect=!0,i}labelFor(t){return" "+t}}e.CompletionProvider=l,e.ParamHintCompletionProvider=class extends l{constructor(t){super(),this.settings=t}provideCompletionItems(t,e,i,c){return n(this,void 0,void 0,(function*(){if(c.triggerCharacter===s.paramHintTrigger){const n=[],c=t.lineAt(e).text.substring(0,e.character-1).trim();if(this.shouldProvideItems(c,e,t)&&!i.isCancellationRequested){const e=this.getParam(c),l=t.getText(),p=(0,s.getDataTypeContainer)(),h=new o.TypeHintProvider(p),u=new a.WorkspaceSearcher(t.uri,this.settings,p);let y=[];if(e&&!i.isCancellationRequested){const t=this.settings.workspaceSearchEnabled?this.workspaceHintSearch(e,u,l):null;try{y=yield h.estimateTypeHints(e,l),y.length>0&&(this.pushEstimationsToItems(y,n),u.cancel())}catch(t){}if(i.isCancellationRequested)return u.cancel(),Promise.resolve(null);this.pushHintsToItems(h.remainingTypeHints(),n,0===y.length),this.itemSortPrefix++,this.pushHintsToItems(h.remainingTypingHints(),n,!1);const o=yield t;return o&&h.hintNotProvided(o)&&n.unshift(this.selectedCompletionItem(o,"0a")),Promise.resolve(new r.CompletionList(n,!1))}}}return Promise.resolve(null)}))}workspaceHintSearch(t,e,i){return n(this,void 0,void 0,(function*(){try{return e.findHintOfSimilarParam(t,i)}catch(t){return null}}))}getParam(t){const e=t.split(/[,(*]/);let i=e.length>1?e[e.length-1].trim():t;return!i||/[!:\]\[?/\\{}.+/=)'";@&£%¤|<>$^~¨ -]/.test(i)?null:i}pushEstimationsToItems(t,e){if(t.length>0){e.push(this.selectedCompletionItem(t[0]));for(let i=1;i<t.length;i++){let n=new r.CompletionItem(this.labelFor(t[i]),r.CompletionItemKind.TypeParameter);n.sortText=`${i}${t[i]}`,e.push(n)}}}shouldProvideItems(t,e,i){if(e.character>0&&!/#/.test(t)){let n=/^[ \t]*(def |async *def )/.test(t);if(!n){const t=e.line>4?4:e.line,o=i.getText(new r.Range(i.lineAt(e.line-t).range.start,e));n=new RegExp("^[ \t]*(async *)?def(?![\\s\\S]+(\\):|-> *[^:\\s]+:))","m").test(o)}return n}return!1}},e.ReturnHintCompletionProvider=class extends l{provideCompletionItems(t,e,i,o){return n(this,void 0,void 0,(function*(){if(o.triggerCharacter!==s.returnHintTrigger)return null;const i=[],n=t.lineAt(e);if(this.shouldProvideItems(n,e)){const e=new c.TypingHintProvider((0,s.getDataTypeContainer)()),n=e.detectTypingImport(t.getText());this.pushHintsToItems(Object.values(s.PythonType),i,!0),this.itemSortPrefix++,yield n,this.pushHintsToItems(e.getRemainingHints(),i,!1)}return Promise.resolve(new r.CompletionList(i,!1))}))}shouldProvideItems(t,e){return e.character>0&&"->"===t.text.substr(e.character-2,2)&&/\) *->[: ]*$/m.test(t.text)}}},949:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TypeCategory=e.PythonType=e.getDataTypeContainer=e.DataType=e.returnHintTrigger=e.paramHintTrigger=e.moduleName=void 0,e.moduleName="[a-zA-Z_][a-zA-Z0-9_.]*",e.paramHintTrigger=":",e.returnHintTrigger=">";class i{constructor(t,e){this.name=t,this.category=e}}var n,r;e.DataType=i,e.getDataTypeContainer=()=>({bool:new i(n.Bool,o.bool),bytes:new i(n.Bytes,o.bytes),complex:new i(n.Complex,o.complex),dict:new i(n.Dict,o.dict),float:new i(n.Float,o.float),int:new i(n.Int,o.int),list:new i(n.List,o.list),object:new i(n.Object,o.object),set:new i(n.Set,o.set),str:new i(n.String,o.string),tuple:new i(n.Tuple,o.tuple)}),function(t){t.Bool="bool",t.Bytes="bytes",t.Complex="complex",t.Dict="dict",t.Float="float",t.Int="int",t.List="list",t.Object="object",t.Set="set",t.String="str",t.Tuple="tuple"}(n=e.PythonType||(e.PythonType={})),function(t){t[t.Abstract=0]="Abstract",t[t.Basic=1]="Basic",t[t.Collection=2]="Collection"}(r=e.TypeCategory||(e.TypeCategory={}));const o={bool:r.Basic,bytes:r.Basic,complex:r.Basic,dict:r.Collection,float:r.Basic,int:r.Basic,list:r.Collection,object:r.Abstract,set:r.Collection,string:r.Basic,tuple:r.Collection}},310:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TypeHintSettings=void 0;const n=i(496);e.TypeHintSettings=class{constructor(){this._workspaceSearchEnabled=!0,this._workspaceSearchLimit=10,this.settingsUpdated=new n.EventEmitter,n.workspace.onDidChangeConfiguration((()=>{this.initialize(),this.settingsUpdated.fire()})),this.initialize()}get workspaceSearchLimit(){return this._workspaceSearchLimit}get workspaceSearchEnabled(){return this._workspaceSearchEnabled}get onDidChangeConfiguration(){return this.settingsUpdated.event}initialize(){const t=n.workspace.getConfiguration("workspace").get("searchEnabled"),e=n.workspace.getConfiguration("workspace").get("searchLimit");void 0!==t&&(this._workspaceSearchEnabled=t),void 0!==e&&(this._workspaceSearchLimit=Number.isInteger(e)?e:Math.round(e))}}},872:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.TypeHintProvider=void 0;const r=i(949),o=i(557),s=i(705);e.TypeHintProvider=class{constructor(t){this.likelyTypes=[r.PythonType.List,r.PythonType.Dict,r.PythonType.String,r.PythonType.Bool,r.PythonType.Int,r.PythonType.Tuple,r.PythonType.Float],this._providedTypeHints=[],this._typingHintProvider=new s.TypingHintProvider(t)}estimateTypeHints(t,e){return n(this,void 0,void 0,(function*(){const i=[],n=o.TypeSearch.variableWithSameName(t,e),r=this._typingHintProvider.detectTypingImport(e);let s=this.getTypeParamEndsWith(t,"_");if(s&&(this.add(s,i),this.tryAddTypingHint(s,i,r)),i.length>0||this.tryAdd(o.TypeSearch.hintOfSimilarParam(t,e),i)||this.tryAdd(o.TypeSearch.classWithSameName(t,e),i))return i;const a=yield n;return null===a||o.TypeSearch.invalidTernaryOperator(a)?(s=this.getTypeParamEndsWith(t,""),s?(this.add(s,i),this.tryAddTypingHint(s,i,r)):this.tryAdd(this.typeGuessFor(t),i)):(this.add(a.typeName,i),this.tryAddTypingHints(a,i,r),this.tryAdd(this.typeGuessFor(t),i)),i}))}remainingTypeHints(){return Object.values(r.PythonType).filter((t=>this.hintNotProvided(t)))}remainingTypingHints(){return this._typingHintProvider.getRemainingHints()}hintNotProvided(t){return!this._providedTypeHints.includes(t)}getTypeParamEndsWith(t,e){const i=t.toUpperCase();for(const t of this.likelyTypes)if(i.endsWith(`${e}${t.toUpperCase()}`))return t;return null}typeGuessFor(t){const e={string:r.PythonType.String,text:r.PythonType.String,path:r.PythonType.String,url:r.PythonType.String,uri:r.PythonType.String,fullpath:r.PythonType.String,full_path:r.PythonType.String,number:r.PythonType.Int,num:r.PythonType.Int};return t in e?e[t]:null}add(t,e){t=t.trim(),this.hintNotProvided(t)&&(e.push(t),this._providedTypeHints.push(t))}tryAdd(t,e){return!!t&&(this.add(t,e),!0)}tryAddTypingHints(t,e,i){if(i){const i=this._typingHintProvider.getHints(t);if(i)for(const t of i)this.add(t,e)}}tryAddTypingHint(t,e,i){if(i){const i=this._typingHintProvider.getHint(t);i&&this.add(i,e)}}}},557:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.TypeSearch=e.VariableSearchResult=e.EstimationSource=void 0;const r=i(949);var o;!function(t){t[t.ClassDefinition=0]="ClassDefinition",t[t.FunctionDefinition=1]="FunctionDefinition",t[t.Value=2]="Value",t[t.ValueOfOtherVariable=3]="ValueOfOtherVariable"}(o=e.EstimationSource||(e.EstimationSource={}));class s{constructor(t,e,i){this.typeName=t,this.estimationSource=e,this.valueAssignment=i}}e.VariableSearchResult=s,e.TypeSearch=class{static classWithSameName(t,e){const i=new RegExp(`^[ \t]*class +(${t})[(:]`,"mi").exec(e);return i?i[1]:null}static variableWithSameName(t,e){return n(this,void 0,void 0,(function*(){let i=this.variableSearchRegExp(t).exec(e);if(!i)return null;const n=i[1];let r=this.detectType(n);if(r)return new s(r,o.Value,n);if(i=/^ *([^(\s#"']+)\(?/.exec(n),!i)return null;if(i[0].endsWith("(")){let t=i[1];return this.classWithSameName(t,e)?new s(t,o.ClassDefinition,n):this.isProbablyAClass(t)?new RegExp(`^[ \t]*def ${t}\\(`).test(e)?null:new s(t,o.Value,n):this.searchForHintedFunctionCall(t,e,n)}if(!this.isImported(i[1],e.substr(i.index-i.length))&&(i=this.variableSearchRegExp(i[1]).exec(e),i)){const t=this.detectType(i[1]);return t?new s(t,o.ValueOfOtherVariable,n):null}return null}))}static searchForHintedFunctionCall(t,e,i){if(t.includes(".")){let e=t.split(".");t=e[e.length-1]}const n=new RegExp(`^[ \t]*def ${t}\\([^)]*\\) *-> *([a-zA-Z_][a-zA-Z0-9_.\\[\\]]+)`,"m").exec(e);return n&&2===n.length?new s(n[1],o.FunctionDefinition,i):null}static detectType(t){const e=[[r.PythonType.List,`${r.PythonType.List}\\(`,"^ *\\["],[r.PythonType.Bool,`${r.PythonType.Bool}\\(`,"^ *(True|False)"],[r.PythonType.Complex,`${r.PythonType.Complex}\\(`,"^ *[()0-9+*\\/ -.]*[0-9][jJ]"],[r.PythonType.Float,`${r.PythonType.Float}\\(`,"^ *[-(]*[0-9+*/ -]*\\.[0-9]"],[r.PythonType.Tuple,`${r.PythonType.Tuple}\\(`,"^ *\\(([^'\",)]+,| *\"[^\"]*\" *,| *'[^']*' *,)"],[r.PythonType.Set,`${r.PythonType.Set}\\(`,"^ *{( *\"[^\"]*\" *[},]+| *'[^']*' *[},]+|[^:]+[}])"],[r.PythonType.Dict,`${r.PythonType.Dict}\\(`,"^ *{"],[r.PythonType.String,`${r.PythonType.String}\\(`,"^ *(['\"]{2}|(\\( *)?\"[^\"]*\"|(\\( *)?'[^']*')"],[r.PythonType.Bytes,`${r.PythonType.Bytes}\\(`,"^ *b['\"]"],[r.PythonType.Int,`${r.PythonType.Int}\\(`,"^ *[-(]*[0-9]"],[r.PythonType.Object,`${r.PythonType.Object}\\(`]];if((t=t.trim()).match("^[a-z]"))for(const i of e){const e=i[0];if(new RegExp(i[1]).test(t))return e}e.pop();for(const i of e){const e=i[0];if(new RegExp(i[2]).test(t))return e}return null}static hintOfSimilarParam(t,e){const i=new RegExp(`^[ \t]*def [^(\\s]+\\([^)]*\\b${t}\\b: *([^),\\s=#:]+)`,"m").exec(e);if(i){return i[1].trim()||null}return null}static invalidTernaryOperator(t){if(t.estimationSource===o.ClassDefinition)return!1;const e=/ if +[^ ]+ +else( +[^ ]+) *$/;let i=e.exec(t.valueAssignment);for(;i;){const n=i[1].trim();let r=this.detectType(n);if(!r)return!1;if(i=e.exec(r),!i)return t.typeName!==r}return!1}static findImport(t,e,i=!0){if(t.includes(".")){const i=t.split("."),n=i[i.length-1],o=i.slice(0,i.length-1).join(".");let s=null;return 2===i.length&&o!==n&&(s=new RegExp(`^[ \t]*import +${o}|^[ \t]*from ${r.moduleName} import (${o})`,"m").exec(e),s)?s[1]?`${s[1]}.${n}`:t:(s=new RegExp(`^[ \t]*import +${o}|^[ \t]*from ${o} import (${n})`,"m").exec(e),s?s[1]?n:t:null)}return this.isImported(t,e,i)?t:null}static isImported(t,e,i=!0){let n=`^[ \t]*(from +${r.moduleName} +import +${t}`;return i&&(n+=`|from +${r.moduleName} +import +${r.moduleName} +as +${t}`),n+=")",new RegExp(n,"m").test(e)}static isProbablyAClass(t){return new RegExp("^([a-zA-Z0-9_]+\\.)*[A-Z]","m").test(t)}static variableSearchRegExp(t){return new RegExp(`^[ \t]*${t} *= *(.+)$`,"m")}}},705:(t,e,i)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.TypingHintProvider=void 0;const n=i(949),r=i(593),o=i(557);e.TypingHintProvider=class{constructor(t){this.typingImportDetected=!1,this.fromTypingImport=!1,this.providedTypes=[],this.typingPrefix="typing",this.typeContainer=t,this.collectionTypes=Object.values(t).filter((t=>t.category===n.TypeCategory.Collection))}detectTypingImport(t){if(/^[ \t]*from typing import +([A-Z][a-zA-Z0-9 ,]+)/m.exec(t))this.fromTypingImport=!0,this.typingImportDetected=!0;else{const e=/^[ \t]*(import +typing +as +([a-zA-Z_][a-zA-Z0-9_-]*)|import +typing)/m.exec(t);e&&(e[2]&&(this.typingPrefix=e[2]),this.typingImportDetected=!0)}return this.typingImportDetected}getHint(t){const e=this.typeContainer[t];return e.category===n.TypeCategory.Collection?(this.providedTypes.push(e),this.toTypingString(e.name,this.fromTypingImport)):null}getHints(t){if(t&&t.typeName in this.typeContainer){const e=this.typeContainer[t.typeName];this.providedTypes.push(e);const i=[this.toTypingString(e.name,this.fromTypingImport)];let r=i[0];if(e.category===n.TypeCategory.Collection){let s=t.valueAssignment.trim().substr(1),a=o.TypeSearch.detectType(s),c=1,l=!1;for(;!l&&a&&a in this.typeContainer&&this.typeContainer[a].category===n.TypeCategory.Collection;)this.typeContainer[a].name===n.PythonType.Dict&&(l=!0),r+=this.toTypingString(a,this.fromTypingImport),s=s.trim().substr(1),a=o.TypeSearch.detectType(s),c++;let p=!1;if(a&&a in this.typeContainer&&(r+=a,p=!l&&e.name!==n.PythonType.Dict),i[0]!==r){if(p)for(let t=0;t<c;t++)r+="]";i.push(r)}return i}}return null}getRemainingHints(){if(!this.typingImportDetected)return this.hintsForAllCollectionTypes();const t=[];for(const e of this.collectionTypes)this.providedTypes.includes(e)||t.push(this.toTypingString(e.name,this.fromTypingImport));return t}hintsForAllCollectionTypes(){const t=[],e=[];for(const i of this.collectionTypes)if(!this.providedTypes.includes(i)){const n=this.fromTypingImport||!this.typingImportDetected;t.push(this.toTypingString(i.name,n)),e.push(this.toTypingString(i.name,!n))}return t.concat(e)}toTypingString(t,e){const i=(0,r.capitalized)(t);return e?`${i}[`:`${this.typingPrefix}.${i}[`}}},593:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.capitalized=void 0,e.capitalized=function(t){return t.length>1?t[0].toUpperCase()+t.slice(1):t}},386:function(t,e,i){var n=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))((function(r,o){function s(t){try{c(n.next(t))}catch(t){o(t)}}function a(t){try{c(n.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(s,a)}c((n=n.apply(t,e||[])).next())}))};Object.defineProperty(e,"__esModule",{value:!0}),e.WorkspaceSearcher=void 0;const r=i(496),o=i(557);e.WorkspaceSearcher=class{constructor(t,e,i){this.search=!0,this.activeDocUri=t,this.settings=e,this.tokenSource=new r.CancellationTokenSource,this.typeContainer=i}findHintOfSimilarParam(t,e){return n(this,void 0,void 0,(function*(){this.search=!0;const i=this.settings.workspaceSearchLimit;if(i>0&&r.workspace.workspaceFolders){const n=this.activeDocUri.path.split("/"),s=`**/${n[n.length-1]}`,a=yield r.workspace.findFiles("**/*.py",s,i,this.tokenSource.token);for(let i=0;this.search&&i<a.length;i++){let n=(yield r.workspace.openTextDocument(a[i])).getText(),s=o.TypeSearch.hintOfSimilarParam(t,n);if(this.search&&s&&(s in this.typeContainer||(s=o.TypeSearch.findImport(s,e,!1)),s))return s}}return null}))}cancel(){this.search&&(this.search=!1,this.tokenSource.cancel())}}},496:t=>{t.exports=require("vscode")}},e={};function i(n){var r=e[n];if(void 0!==r)return r.exports;var o=e[n]={exports:{}};return t[n].call(o.exports,o,o.exports,i),o.exports}var n={};(()=>{var t=n;Object.defineProperty(t,"__esModule",{value:!0}),t.deactivate=t.activate=void 0;const e=i(496),r=i(113),o=i(949),s=i(310);t.activate=function(t){const i=new s.TypeHintSettings;t.subscriptions.push(e.languages.registerCompletionItemProvider("python",new r.ParamHintCompletionProvider(i),o.paramHintTrigger),e.languages.registerCompletionItemProvider("python",new r.ReturnHintCompletionProvider,o.returnHintTrigger))},t.deactivate=function(){}})(),module.exports=n})();
//# sourceMappingURL=extension.js.map